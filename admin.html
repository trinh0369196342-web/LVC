<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Trị Viên - Hệ Thống Quản Lý In Ấn</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-cog"></i> Quản Trị Viên</h2>
                <div class="user-info">
                    <p id="admin-name">Đang tải...</p>
                    <p id="admin-email">Đang tải...</p>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <a href="#account" class="nav-item active">
                    <i class="fas fa-user-edit"></i> Quản Lý Tài Khoản
                </a>
                <a href="#dashboard" class="nav-item">
                    <i class="fas fa-chart-bar"></i> Thống Kê Hệ Thống
                </a>
                <a href="#manage-orders" class="nav-item">
                    <i class="fas fa-tasks"></i> Quản Lý Đơn Hàng
                </a>
                <a href="#manage-users" class="nav-item">
                    <i class="fas fa-users"></i> Quản Lý Người Dùng
                </a>
                <a href="#support" class="nav-item">
                    <i class="fas fa-comments"></i> Hỗ Trợ Hệ Thống
                </a>
                <a href="#system-settings" class="nav-item">
                    <i class="fas fa-sliders-h"></i> Cài Đặt Hệ Thống
                </a>
            </nav>
            
            <button class="btn btn-logout" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Đăng Xuất
            </button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <header class="main-header">
                <h1 id="page-title">Quản Lý Tài Khoản</h1>
                <div class="header-actions">
                    <button class="btn btn-notification" onclick="toggleNotifications()">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notification-count">0</span>
                    </button>
                    <button class="btn btn-info" onclick="refreshData()">
                        <i class="fas fa-sync-alt"></i> Làm mới
                    </button>
                    <button class="btn btn-warning" onclick="exportData()">
                        <i class="fas fa-download"></i> Xuất báo cáo
                    </button>
                </div>
            </header>

            <!-- Phần Quản Lý Tài Khoản -->
            <section id="account" class="content-section active">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-user-cog"></i> Quản Lý Thông Tin Tài Khoản</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="admin-edit-name">Họ và tên</label>
                            <input type="text" id="admin-edit-name" class="form-control" placeholder="Nhập họ và tên">
                        </div>
                        
                        <div class="form-group">
                            <label for="admin-edit-phone">Số điện thoại</label>
                            <input type="tel" id="admin-edit-phone" class="form-control" placeholder="Nhập số điện thoại">
                        </div>
                        
                        <div class="form-group">
                            <label for="admin-edit-role">Vai trò hệ thống</label>
                            <select id="admin-edit-role" class="form-control" disabled>
                                <option value="admin">Quản trị viên</option>
                            </select>
                        </div>
                        
                        <button class="btn btn-primary btn-lg" id="save-admin-account">
                            <i class="fas fa-save"></i> Lưu Thông Tin
                        </button>
                    </div>
                </div>
            </section>

            <!-- Phần Thống Kê Hệ Thống -->
            <section id="dashboard" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-line"></i> Thống Kê Toàn Hệ Thống</h3>
                    </div>
                    <div class="card-body">
                        <div class="stats-overview">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                                <div class="stat-card text-center" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 10px;">
                                    <h5>Tổng Người Dùng</h5>
                                    <h2 id="total-users">0</h2>
                                </div>
                                <div class="stat-card text-center" style="background: linear-gradient(135deg, #4cc9f0, #4361ee); color: white; padding: 20px; border-radius: 10px;">
                                    <h5>Tổng Đơn Hàng</h5>
                                    <h2 id="total-orders">0</h2>
                                </div>
                                <div class="stat-card text-center" style="background: linear-gradient(135deg, #f72585, #b5179e); color: white; padding: 20px; border-radius: 10px;">
                                    <h5>Doanh Thu Tháng</h5>
                                    <h2 id="monthly-revenue">0 VNĐ</h2>
                                </div>
                                <div class="stat-card text-center" style="background: linear-gradient(135deg, #f8961e, #f3722c); color: white; padding: 20px; border-radius: 10px;">
                                    <h5>Đơn Hoàn Thành</h5>
                                    <h2 id="completed-orders">0</h2>
                                </div>
                            </div>
                        </div>
                        
                        <div class="charts-container">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h3>Phân Bố Người Dùng</h3>
                                    <p>Biểu đồ phân bố người dùng theo vai trò</p>
                                </div>
                                <div class="chart-wrapper">
                                    <canvas id="admin-pie-chart"></canvas>
                                </div>
                            </div>
                            
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h3>Tăng Trưởng Người Dùng</h3>
                                    <p>Biểu đồ tăng trưởng người dùng theo thời gian</p>
                                </div>
                                <div class="chart-wrapper">
                                    <canvas id="admin-line-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <div class="recent-activity mt-3">
                            <div class="card">
                                <div class="card-header">
                                    <h4><i class="fas fa-history"></i> Hoạt Động Gần Đây</h4>
                                </div>
                                <div class="card-body">
                                    <div id="activity-list">
                                        <div class="text-center">
                                            <div class="spinner"></div>
                                            <p>Đang tải hoạt động...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Phần Quản Lý Đơn Hàng -->
            <section id="manage-orders" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-tasks"></i> Quản Lý Tất Cả Đơn Hàng</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-filters mb-3">
                            <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                                <select id="admin-order-filter-status" class="form-control" style="width: 200px;">
                                    <option value="all">Tất cả trạng thái</option>
                                    <option value="pending">Chờ xử lý</option>
                                    <option value="processing">Đang xử lý</option>
                                    <option value="payment_requested">Chờ thanh toán</option>
                                    <option value="received">Đã nhận</option>
                                    <option value="completed">Hoàn thành</option>
                                    <option value="cancelled">Đã hủy</option>
                                </select>
                                
                                <select id="admin-order-filter-seller" class="form-control" style="width: 200px;">
                                    <option value="all">Tất cả người bán</option>
                                    <!-- Danh sách người bán sẽ được tải ở đây -->
                                </select>
                                
                                <input type="date" id="admin-order-filter-date" class="form-control" style="width: 200px;">
                                
                                <button class="btn btn-secondary" onclick="adminFilterOrders()">
                                    <i class="fas fa-filter"></i> Lọc
                                </button>
                                
                                <button class="btn btn-info" onclick="adminResetFilters()">
                                    <i class="fas fa-redo"></i> Đặt lại
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Mã ĐH</th>
                                        <th>Khách Hàng</th>
                                        <th>Người Bán</th>
                                        <th>Ngày Đặt</th>
                                        <th>Tổng Tiền</th>
                                        <th>Trạng Thái</th>
                                        <th>Thao Tác</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-orders-table-body">
                                    <tr>
                                        <td colspan="7" class="text-center">
                                            <div class="spinner"></div>
                                            <p>Đang tải dữ liệu...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Phần Quản Lý Người Dùng -->
            <section id="manage-users" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-users-cog"></i> Quản Lý Người Dùng Hệ Thống</h3>
                    </div>
                    <div class="card-body">
                        <div class="user-filters mb-3">
                            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                                <select id="user-filter-role" class="form-control" style="width: 200px;">
                                    <option value="all">Tất cả vai trò</option>
                                    <option value="customer">Khách hàng</option>
                                    <option value="seller">Người bán</option>
                                    <option value="admin">Quản trị viên</option>
                                </select>
                                
                                <select id="user-filter-status" class="form-control" style="width: 200px;">
                                    <option value="all">Tất cả trạng thái</option>
                                    <option value="active">Đang hoạt động</option>
                                    <option value="inactive">Không hoạt động</option>
                                    <option value="banned">Đã khóa</option>
                                </select>
                                
                                <button class="btn btn-secondary" onclick="filterUsers()">
                                    <i class="fas fa-filter"></i> Lọc
                                </button>
                                
                                <button class="btn btn-success" onclick="showAddUserModal()">
                                    <i class="fas fa-user-plus"></i> Thêm người dùng
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Họ Tên</th>
                                        <th>Email</th>
                                        <th>Vai Trò</th>
                                        <th>Số Điện Thoại</th>
                                        <th>Trạng Thái</th>
                                        <th>Ngày Tạo</th>
                                        <th>Thao Tác</th>
                                    </tr>
                                </thead>
                                <tbody id="users-table-body">
                                    <tr>
                                        <td colspan="8" class="text-center">
                                            <div class="spinner"></div>
                                            <p>Đang tải dữ liệu...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Phần Hỗ Trợ Hệ Thống -->
            <section id="support" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-headset"></i> Hỗ Trợ Toàn Hệ Thống</h3>
                    </div>
                    <div class="card-body">
                        <div class="chat-container">
                            <div class="chat-sidebar">
                                <div class="form-group">
                                    <label for="admin-receiver-type">Loại tin nhắn</label>
                                    <select id="admin-receiver-type" class="form-control">
                                        <option value="broadcast">Gửi hàng loạt</option>
                                        <option value="specific">Gửi cho người cụ thể</option>
                                        <option value="room">Tham gia phòng chat</option>
                                    </select>
                                </div>
                                
                                <div id="specific-receiver-container" class="hidden">
                                    <div class="form-group">
                                        <label for="admin-specific-receiver">Chọn người nhận</label>
                                        <select id="admin-specific-receiver" class="form-control">
                                            <!-- Danh sách người dùng sẽ được tải ở đây -->
                                        </select>
                                    </div>
                                </div>
                                
                                <div id="room-select-container" class="hidden">
                                    <div class="form-group">
                                        <label for="admin-room-select">Chọn phòng chat</label>
                                        <select id="admin-room-select" class="form-control">
                                            <option value="all">Tất cả phòng chat</option>
                                            <!-- Danh sách phòng chat sẽ được tải ở đây -->
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="file-upload">
                                    <label for="admin-file-upload" class="btn btn-secondary">
                                        <i class="fas fa-paperclip"></i> Chọn File
                                    </label>
                                    <input type="file" id="admin-file-upload" hidden>
                                    <span id="admin-file-name">Chưa chọn file</span>
                                </div>
                            </div>
                            
                            <div class="chat-main">
                                <div class="chat-messages" id="admin-chat-messages">
                                    <div class="message empty">
                                        <p><i class="fas fa-comments fa-2x"></i></p>
                                        <p>Chưa có tin nhắn nào. Hãy bắt đầu trò chuyện!</p>
                                    </div>
                                </div>
                                
                                <div class="chat-input">
                                    <input type="text" id="admin-message-input" class="form-control" placeholder="Nhập tin nhắn của bạn...">
                                    <button class="btn btn-primary" id="admin-send-message">
                                        <i class="fas fa-paper-plane"></i> Gửi
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Phần Cài Đặt Hệ Thống -->
            <section id="system-settings" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-sliders-h"></i> Cài Đặt Hệ Thống</h3>
                    </div>
                    <div class="card-body">
                        <div class="settings-sections">
                            <div class="form-group">
                                <label for="system-name">Tên hệ thống</label>
                                <input type="text" id="system-name" class="form-control" placeholder="Nhập tên hệ thống">
                            </div>
                            
                            <div class="form-group">
                                <label for="system-currency">Đơn vị tiền tệ</label>
                                <select id="system-currency" class="form-control">
                                    <option value="VND">VNĐ - Đồng Việt Nam</option>
                                    <option value="USD">USD - Đô la Mỹ</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="price-per-table">Giá mỗi bảng in (VNĐ)</label>
                                <input type="number" id="price-per-table" class="form-control" value="50000" min="1000">
                            </div>
                            
                            <div class="form-group">
                                <label for="max-tables-per-order">Số bảng tối đa mỗi đơn</label>
                                <input type="number" id="max-tables-per-order" class="form-control" value="8" min="1" max="20">
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="enable-email-notifications" checked>
                                    Bật thông báo qua email
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="enable-auto-backup" checked>
                                    Tự động sao lưu dữ liệu
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label for="backup-frequency">Tần suất sao lưu</label>
                                <select id="backup-frequency" class="form-control">
                                    <option value="daily">Hàng ngày</option>
                                    <option value="weekly">Hàng tuần</option>
                                    <option value="monthly">Hàng tháng</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-primary btn-lg" onclick="saveSystemSettings()">
                                <i class="fas fa-save"></i> Lưu Cài Đặt
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Modal Thêm Người Dùng -->
    <div id="add-user-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Thêm Người Dùng Mới</h3>
                <button class="btn btn-sm btn-danger" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="new-user-name">Họ và tên</label>
                    <input type="text" id="new-user-name" class="form-control" placeholder="Nhập họ và tên">
                </div>
                
                <div class="form-group">
                    <label for="new-user-email">Email</label>
                    <input type="email" id="new-user-email" class="form-control" placeholder="Nhập email">
                </div>
                
                <div class="form-group">
                    <label for="new-user-phone">Số điện thoại</label>
                    <input type="tel" id="new-user-phone" class="form-control" placeholder="Nhập số điện thoại">
                </div>
                
                <div class="form-group">
                    <label for="new-user-role">Vai trò</label>
                    <select id="new-user-role" class="form-control">
                        <option value="customer">Khách hàng</option>
                        <option value="seller">Người bán</option>
                        <option value="admin">Quản trị viên</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="new-user-password">Mật khẩu</label>
                    <input type="password" id="new-user-password" class="form-control" placeholder="Nhập mật khẩu">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Hủy</button>
                <button class="btn btn-primary" onclick="createNewUser()">Tạo Người Dùng</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Khởi tạo trang quản trị viên
        document.addEventListener('DOMContentLoaded', function() {
            initAdminPage();
        });
        
        // Thêm CSS cho modal nếu chưa có
        if (!document.querySelector('style[data-modal-style]')) {
            const modalStyle = document.createElement('style');
            modalStyle.setAttribute('data-modal-style', 'true');
            modalStyle.textContent = `
                .modal {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                }
                
                .modal.hidden {
                    display: none;
                }
                
                .modal-content {
                    background: white;
                    border-radius: 15px;
                    width: 90%;
                    max-width: 500px;
                    max-height: 90vh;
                    overflow-y: auto;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                }
                
                .modal-header {
                    padding: 20px;
                    background: linear-gradient(135deg, var(--primary), var(--secondary));
                    color: white;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    border-radius: 15px 15px 0 0;
                }
                
                .modal-header h3 {
                    margin: 0;
                    font-size: 1.3rem;
                }
                
                .modal-body {
                    padding: 20px;
                }
                
                .modal-footer {
                    padding: 20px;
                    display: flex;
                    justify-content: flex-end;
                    gap: 10px;
                    border-top: 1px solid var(--light-gray);
                }
            `;
            document.head.appendChild(modalStyle);
        }
    </script>
</body>
</html>