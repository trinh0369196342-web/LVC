<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Người Bán</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="nav">
        <b>NGƯỜI BÁN</b> | 
        <button onclick="show('info')">1. Tài Khoản</button>
        <button onclick="show('chat')">2. Hỗ Trợ</button>
        <button onclick="show('market')">3. Chợ Đơn Hàng</button>
        <button onclick="show('chart')">4. Biểu Đồ</button>
        <button onclick="logout()" style="float:right;">Đăng xuất</button>
    </div>

    <div id="info" class="section">
        <h3>Thông tin người bán</h3>
        <p>Email: <span id="seller-email">...</span></p>
    </div>

    <div id="chat" class="section hidden">
        <h3>Hỗ Trợ (Khách & Admin)</h3>
        <p>Chat với khách đã nhận đơn hoặc chat Admin.</p>
    </div>

    <div id="market" class="section hidden">
        <h3>Đơn hàng</h3>
        <h4>Đơn mới (Chưa ai nhận)</h4>
        <div style="border:1px solid red; padding:10px; margin-bottom:10px;">
            Đơn #101 - Khách A - <button>Nhận đơn</button>
        </div>
        
        <hr>
        <h4>Đơn tôi đang làm</h4>
        <div style="border:1px solid blue; padding:10px;">
            Đơn #99 - Đang xử lý
            <br>
            <button>Copy Nội Dung</button> <button>Gửi Mã Ảnh</button> <button>Hủy</button>
        </div>
    </div>

    <div id="chart" class="section hidden">
        <h3>Thống kê doanh thu</h3>
        <p>Biểu đồ cá nhân của tôi...</p>
    </div>

    <script>
        function show(id) {
            document.querySelectorAll('.section').forEach(el => el.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        const SUPABASE_URL = 'DÁN_URL_CỦA_BẠN_VÀO_ĐÂY';
        const SUPABASE_KEY = 'DÁN_KEY_CỦA_BẠN_VÀO_ĐÂY';
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function logout() {
            await supabase.auth.signOut();
            window.location.href = 'login.html';
        }

        async function checkAuth() {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) window.location.href = 'login.html';
            
            // Check đúng quyền seller không
            const { data: profile } = await supabase.from('profiles').select('role').eq('id', session.user.id).single();
            if (profile.role !== 'seller') {
                alert('Bạn không phải người bán!');
                window.location.href = 'login.html';
            }
            document.getElementById('seller-email').innerText = session.user.email;
        }
        checkAuth();
    </script>
</body>
</html>
